
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FantacalcioAI ‚Äì Aste, Consigli, Roster</title>
  <link rel="icon" type="image/svg+xml" href="/static/assets/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/static/styles/fantacalcioai.css">
  <meta name="theme-color" content="#0A84FF">
</head>
<body>
  <header class="header">
    <div class="container nav">
      <a class="brand" href="/">
        <svg width="280" height="68" viewBox="0 0 280 48" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="title desc">
          <title id="title">FantacalcioAI - Logo</title>
          <desc id="desc">Wordmark con monogramma a scudo, pallone e nodi AI orbitanti</desc>
          <g transform="translate(4,4)">
            <path d="M20 0 L38 6 C38 20 31 31 20 40 C9 31 2 20 2 6 L20 0Z" fill="#0A84FF"/>
            <circle cx="20" cy="18" r="9" fill="white"/>
            <polygon points="20,11 24,14 23,19 17,19 16,14" fill="#0A84FF"/>
            <circle cx="15.5" cy="16.5" r="2" fill="#0A84FF"/>
            <circle cx="24.5" cy="16.5" r="2" fill="#0A84FF"/>
            <circle cx="20" cy="21.5" r="2" fill="#0A84FF"/>
            <path d="M9,12 C20,3 31,10 30,19" stroke="#72E3A6" stroke-width="1.5" fill="none"/>
            <circle cx="9" cy="12" r="2" fill="#72E3A6"/>
            <circle cx="30" cy="19" r="2" fill="#72E3A6"/>
          </g>
          <g transform="translate(52,12)">
            <text x="0" y="16" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
                  font-size="22" font-weight="700" fill="var(--fcai-text)" letter-spacing="0.2">
              Fantacalcio
            </text>
            <rect x="111" y="2" width="4" height="22" rx="2" fill="#0A84FF"/>
            <text x="118" y="16" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
                  font-size="18" font-weight="800" fill="#0A84FF" letter-spacing="0.4">
              AI
            </text>
            <text x="0" y="32" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
                  font-size="10.5" fill="var(--fcai-text-dim)" letter-spacing="0.3">
              insights ‚Ä¢ aste ‚Ä¢ consigli in tempo reale
            </text>
          </g>
        </svg>
      </a>
      <nav class="spacer"></nav>
      <a class="btn" href="#funzioni">Funzioni</a>
      <a class="btn btn-primary" href="/app">Apri App</a>
    </div>
  </header>

  <section class="hero">
    <div class="container wrap">
      <div>
        <span class="kicker">‚öΩ + ü§ñ Consigli data-driven</span>
        <h1 class="h1">Aste intelligenti e consigli in tempo reale per la Serie A</h1>
        <p class="lead">Ranking dinamici, budget optimizer, scouting U21 e analisi avversari. Mobile-first, ora anche "website-like".</p>
        <div class="btn-group mt-2">
          <a class="btn cta" href="/app">Apri l'app</a>
          <a class="btn ghost" href="/app">Leghe</a>
        </div>
        <div class="kpis mt-3">
          <div class="kpi"><div class="label">Database giocatori</div><div class="value">800+</div></div>
          <div class="kpi"><div class="label">Ruoli & filtri</div><div class="value">30+</div></div>
          <div class="kpi"><div class="label">Consigli/ora</div><div class="value">‚àû</div></div>
          <div class="kpi"><div class="label">Modalit√†</div><div class="value">Classic ‚Ä¢ Mantra</div></div>
        </div>
      </div>
      <div class="card pad">
        <div class="toolbar">
          <div class="search" style="flex:1">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15a7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <input id="searchInput" type="text" placeholder="Cerca giocatori, squadra, ruolo‚Ä¶">
          </div>
          <button class="btn toggle" id="u21Toggle">U21</button>
          <button class="btn toggle active" id="formToggle">In forma</button>
        </div>
        <div class="mt-2">
          <div id="loadingIndicator" class="help">Caricamento dati giocatori...</div>
          <table class="table" id="playersTable" style="display: none;">
            <thead><tr><th>Nome</th><th>Ruolo</th><th>Squadra</th><th>Fantamedia</th><th>Prezzo</th></tr></thead>
            <tbody id="playersTableBody"></tbody>
          </table>
          <div id="playersCount" class="help mt-1"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Enhanced Features Section with 2x2 grid -->
  <section id="funzioni" class="section">
    <div class="container">
      <div class="grid-2" style="gap: 24px; margin-bottom: 32px;">
        <div class="card pad">
          <h2>üéØ Ranking & Fantamedia intelligente</h2>
          <p>Combina fantamedie storiche, xG/xA, forma e calendario. Filtri per ruolo avanzati con analisi predittiva.</p>
          <div class="btn-group mt-2">
            <button onclick="getTopPlayersByRole('A')" class="btn primary">Top Attaccanti</button>
            <button onclick="getTopPlayersByRole('C')" class="btn ghost">Top Centrocampisti</button>
          </div>
        </div>
        <div class="card pad">
          <h2>üí∞ Budget optimizer</h2>
          <p>Strategie d'asta simulate: aggressiva, bilanciata, low-cost con slot e vincoli di lega personalizzati.</p>
          <div class="btn-group mt-2">
            <button onclick="askFormationAdvice('3-5-2')" class="btn primary">Strategia 3-5-2</button>
            <button onclick="askFormationAdvice('4-3-3')" class="btn ghost">Strategia 4-3-3</button>
          </div>
        </div>
      </div>
      
      <div class="grid-2" style="gap: 24px;">
        <div class="card pad">
          <h2>üë∂ Scouting U21</h2>
          <p>Rileva prospetti con minuti crescenti e valore fantacalcistico in aumento. Algoritmi di machine learning.</p>
          <div class="btn-group mt-2">
            <button onclick="getU21PlayersByRole('A')" class="btn primary">U21 Attaccanti</button>
            <button onclick="getU21PlayersByRole('C')" class="btn ghost">U21 Centrocampisti</button>
          </div>
        </div>
        <div class="card pad">
          <h2>‚ö° Assistenza in tempo reale</h2>
          <p>Suggerimenti live per schieramento, cambi e ballottaggi. Notifiche automatiche sugli infortuni.</p>
          <div class="btn-group mt-2">
            <a class="btn primary" href="/app">Inizia ora</a>
            <button onclick="getTeamAcquisitions('Inter')" class="btn ghost">Acquisti Inter</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Working Demo Section -->
  <section class="section alt">
    <div class="container grid-2">
      <div>
        <h2>Un'unica UI per mobile e desktop</h2>
        <p>La stessa base CSS gestisce l'interfaccia "app-like" e il layout "website-like". Meno manutenzione, pi√π consistenza.</p>
        <div class="btn-group mt-2">
          <a class="btn primary" href="/app">Apri App</a>
          <a class="btn" href="#funzioni">Vedi funzioni</a>
        </div>
      </div>
      <div class="card pad">
        <h3>üîß Configurazione Lega</h3>
        <form class="form" onsubmit="return handleLeagueSetup(event)">
          <div>
            <label class="label">Modalit√† di lega</label>
            <select class="select" id="leagueMode"><option>Classic</option><option>Mantra</option><option>Draft</option></select>
          </div>
          <div>
            <label class="label">Budget iniziale</label>
            <input class="input" type="number" id="initialBudget" placeholder="500" value="500"/>
            <div class="help">Valore per squadra</div>
          </div>
          <div>
            <label class="label">Formazione preferita</label>
            <select class="select" id="preferredFormation"><option>3-4-3</option><option>3-5-2</option><option>4-3-3</option><option>4-4-2</option></select>
          </div>
          <button type="submit" class="btn cta">Genera strategia d'asta</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Live Player Data Section -->
  <section class="section">
    <div class="container">
      <h2 style="text-align: center; margin-bottom: 32px;">üî• Dati Live Serie A 2025-26</h2>
      <div id="liveDataContainer" class="grid-2" style="gap: 24px;">
        <div class="card pad">
          <h3>‚öΩ Top Attaccanti</h3>
          <div id="topAttackers">Caricamento...</div>
        </div>
        <div class="card pad">
          <h3>üéØ Top Centrocampisti</h3>
          <div id="topMidfielders">Caricamento...</div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">¬© <span id="y"></span> FantacalcioAI. Tutti i diritti riservati.</div>
  </footer>

  <script>
    document.getElementById('y').textContent=new Date().getFullYear();

    // Desktop App Functionality - Real API Integration
    let currentRole = 'all';
    let playersData = [];
    
    // Load real player data when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadPlayersData();
        setupEventListeners();
        loadLiveData();
    });

    function setupEventListeners() {
        // Search functionality with debouncing
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterAndDisplayPlayers();
                }, 300);
            });
        }

        // Toggle buttons
        const u21Toggle = document.getElementById('u21Toggle');
        const formToggle = document.getElementById('formToggle');
        
        if (u21Toggle) {
            u21Toggle.addEventListener('click', function() {
                this.classList.toggle('active');
                filterAndDisplayPlayers();
            });
        }

        if (formToggle) {
            formToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                filterAndDisplayPlayers();
            });
        }
    }

    async function loadPlayersData() {
        await searchPlayers();
    }

    async function searchPlayers() {
        try {
            const searchInputEl = document.getElementById('searchInput');
            const searchQuery = searchInputEl ? searchInputEl.value : '';
            const u21ToggleEl = document.getElementById('u21Toggle');
            const isU21Active = u21ToggleEl ? u21ToggleEl.classList.contains('active') : false;
            const formToggleEl = document.getElementById('formToggle');
            const isFormActive = formToggleEl ? formToggleEl.classList.contains('active') : false;
            
            const params = new URLSearchParams();
            if (searchQuery) params.append('search', searchQuery);
            if (isU21Active) params.append('u21', 'true');
            if (isFormActive) params.append('in_forma', 'true');
            params.append('limit', '20');
            
            const response = await fetch(`/api/players?${params.toString()}`);
            const data = await response.json();
            
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }

            const table = document.getElementById('playersTable');
            if (table) {
                table.style.display = 'table';
            }

            const players = data.players || [];
            displayPlayers(players);
            updatePlayersCount(players.length, data.total || 0);

        } catch (error) {
            console.error('Error loading players data:', error);
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.textContent = 'Errore nel caricamento dei dati. Riprova pi√π tardi.';
            }
        }
    }

    function filterAndDisplayPlayers() {
        searchPlayers();
    }

    function displayPlayers(players) {
        const tbody = document.getElementById('playersTableBody');
        if (!tbody) return;
        
        tbody.innerHTML = players.map(player => `
            <tr>
                <td><strong>${player.display_name || player.name}</strong></td>
                <td><span style="padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: bold; color: white; background: ${getRoleColor(player.role)}">${player.role}</span></td>
                <td>${player.team}</td>
                <td>${player.fantamedia || 0}</td>
                <td>‚Ç¨${player.price || 0}</td>
            </tr>
        `).join('');
    }

    function updatePlayersCount(displayed, total) {
        const countElement = document.getElementById('playersCount');
        if (countElement) {
            countElement.textContent = `Visualizzati ${displayed} di ${total} giocatori trovati - dati reali da FantacalcioAI`;
        }
    }

    function getRoleColor(role) {
        const colors = {
            'P': '#22C55E',
            'D': '#3B82F6',
            'C': '#F59E0B',
            'A': '#EF4444'
        };
        return colors[role] || '#6B7280';
    }

    function showQuickResult(title, message) {
        const resultDiv = document.createElement('div');
        resultDiv.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 24px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px; z-index: 1000; color: #333; font-family: system-ui;
        `;
        resultDiv.innerHTML = `
            <h3 style="margin: 0 0 16px 0; color: #667eea;">${title}</h3>
            <p style="margin: 0 0 20px 0; line-height: 1.6;">${message}</p>
            <button onclick="this.parentElement.remove(); document.getElementById('overlay').remove()" 
                    style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">Chiudi</button>
        `;
        
        const overlay = document.createElement('div');
        overlay.id = 'overlay';
        overlay.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 999;
        `;
        overlay.onclick = () => { resultDiv.remove(); overlay.remove(); };
        
        document.body.appendChild(overlay);
        document.body.appendChild(resultDiv);
    }

    async function getTopPlayersByRole(role) {
        try {
            const response = await fetch(`/api/players?role=${role}&in_forma=true&limit=5`);
            const data = await response.json();
            const players = data.players || [];
            
            const roleNames = { 'A': 'Attaccanti', 'C': 'Centrocampisti', 'D': 'Difensori', 'P': 'Portieri' };
            const roleName = roleNames[role] || 'Giocatori';
            
            if (players.length > 0) {
                const playersList = players.map(p => `${p.display_name || p.name} (${p.team}, FM ${p.fantamedia})`).join(', ');
                showQuickResult(`üéØ Top ${roleName}`, `I migliori ${roleName.toLowerCase()} in forma: ${playersList}`);
            } else {
                showQuickResult(`üéØ Top ${roleName}`, `Nessun ${roleName.toLowerCase()} trovato in questo momento.`);
            }
        } catch (error) {
            showQuickResult('‚ùå Errore', 'Errore nel caricamento dei dati. Riprova pi√π tardi.');
        }
    }

    async function getU21PlayersByRole(role) {
        try {
            const response = await fetch(`/api/players?role=${role}&u21=true&limit=5`);
            const data = await response.json();
            const players = data.players || [];
            
            const roleNames = { 'A': 'Attaccanti', 'C': 'Centrocampisti', 'D': 'Difensori', 'P': 'Portieri' };
            const roleName = roleNames[role] || 'Giocatori';
            
            if (players.length > 0) {
                const playersList = players.map(p => `${p.display_name || p.name} (${p.team})`).join(', ');
                showQuickResult(`üë∂ U21 ${roleName}`, `I migliori ${roleName.toLowerCase()} Under 21: ${playersList}`);
            } else {
                showQuickResult(`üë∂ U21 ${roleName}`, `Nessun ${roleName.toLowerCase()} Under 21 trovato in questo momento.`);
            }
        } catch (error) {
            showQuickResult('‚ùå Errore', 'Errore nel caricamento dei dati. Riprova pi√π tardi.');
        }
    }

    async function askFormationAdvice(formation) {
        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: `Consigli per formazione ${formation}` })
            });
            const data = await response.json();
            showQuickResult(`‚öΩ Formazione ${formation}`, data.response || 'Consigli per formazione non disponibili al momento.');
        } catch (error) {
            showQuickResult('‚ùå Errore', 'Errore nel caricamento dei consigli. Riprova pi√π tardi.');
        }
    }

    async function getTeamAcquisitions(team) {
        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: `Ultimi acquisti ${team}` })
            });
            const data = await response.json();
            showQuickResult(`üìà Acquisti ${team}`, data.response || 'Informazioni sugli acquisti non disponibili al momento.');
        } catch (error) {
            showQuickResult('‚ùå Errore', 'Errore nel caricamento delle informazioni. Riprova pi√π tardi.');
        }
    }

    function handleLeagueSetup(event) {
        event.preventDefault();
        const mode = document.getElementById('leagueMode').value;
        const budget = document.getElementById('initialBudget').value;
        const formation = document.getElementById('preferredFormation').value;
        
        showQuickResult(
            'üèÜ Strategia Personalizzata', 
            `Modalit√†: ${mode} | Budget: ‚Ç¨${budget} | Formazione: ${formation}<br><br>` +
            `‚úÖ Strategia consigliata: concentra il 60% del budget sui top player, diversifica per ruolo, ` +
            `punta sui giovani U21 per il futuro. Inizia con la formazione ${formation} e adatta in base agli acquisti.`
        );
        return false;
    }

    async function loadLiveData() {
        try {
            // Load top attackers
            const attackersResponse = await fetch('/api/players?role=A&in_forma=true&limit=3');
            const attackersData = await attackersResponse.json();
            const topAttackers = attackersData.players || [];
            
            // Load top midfielders
            const midfieldersResponse = await fetch('/api/players?role=C&in_forma=true&limit=3');
            const midfieldersData = await midfieldersResponse.json();
            const topMidfielders = midfieldersData.players || [];
            
            // Display top attackers
            const attackersContainer = document.getElementById('topAttackers');
            if (attackersContainer && topAttackers.length > 0) {
                attackersContainer.innerHTML = topAttackers.map((player, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${player.display_name || player.name}</strong><br>
                            <small style="color: #666;">${player.team}</small>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; color: #EF4444;">FM ${player.fantamedia}</div>
                            <div style="font-size: 12px; color: #666;">‚Ç¨${player.price}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Display top midfielders
            const midfieldersContainer = document.getElementById('topMidfielders');
            if (midfieldersContainer && topMidfielders.length > 0) {
                midfieldersContainer.innerHTML = topMidfielders.map((player, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${player.display_name || player.name}</strong><br>
                            <small style="color: #666;">${player.team}</small>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; color: #F59E0B;">FM ${player.fantamedia}</div>
                            <div style="font-size: 12px; color: #666;">‚Ç¨${player.price}</div>
                        </div>
                    </div>
                `).join('');
            }
            
        } catch (error) {
            console.error('Error loading live data:', error);
        }
    }
  </script>
</body>
</html>
